---
title: "problem3"
output: html_document
date: "2024-11-15"
---

```{r}
library(tidyverse)
library(purrr)
library(broom)
```

## problem3

```{r}
#read data
data = read_csv("./data/homicide-data.csv") |>
  janitor::clean_names() |>
  drop_na()
```

The number of rows and columns in the homicides data: **`r dim_desc(data)`** 
The column variables are: **`r colnames(data)`** . The dataset includes information about victim, reported date of homicide, location of homicide, and status of the case. 

```{r}
summary_data = data |>
  mutate(city_state = paste(city, state, sep="_"), 
         not_solved = if_else(
           disposition %in% c("Closed without arrest", "Open/No arrest"), 1, 0))  |> # if match, add 1, otherwise, add 0. 
  group_by(city_state) |>
  summarize(
    total_number_of_homicides = n(), #count
    unsolved_homicides = sum(not_solved) 
  ) #|>
  #knitr::kable()
head(summary_data)
```


```{r}
prop_result_baltimore = summary_data |>
  filter(city_state == "Baltimore_MD") |>
  mutate(prop_test_out_balti = map2(unsolved_homicides,total_number_of_homicides, \(x,y) prop.test(x,y)),
  tidy_df = map(prop_test_out_balti,tidy))|> 
  unnest(tidy_df) |>
  select(city_state,estimate,conf.low,conf.high) 

prop_result_baltimore |> 
  knitr::kable()
```

```{r}
prop_results_all_cities = summary_data |>
  mutate(prop_test_out_all = map2(unsolved_homicides,total_number_of_homicides, \(x,y) prop.test(x,y)),
         tidy_df = map(prop_test_out_all,tidy))|>
  unnest(tidy_df) |>
  select(city_state,estimate,conf.low,conf.high)
  
prop_results_all_cities |>
 mutate(city_state = fct_reorder(city_state,estimate)) |>
  ggplot(aes(x = city_state, y = estimate)) + 
  geom_point(color="purple") +
  geom_errorbar(aes(ymin=conf.low, ymax = conf.high), color = "orange") +
  coord_flip() + #to facilitate the viewing - otherwise - x-axis crowded
  labs(
    title = "proportion of unsolved homicides",
    x = "estimate",
    y = "city and state", 
  )
```



